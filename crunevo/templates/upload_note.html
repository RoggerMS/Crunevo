{% extends 'base.html' %}

{% block title %}Subir Apunte - Plataforma Apuntes Cantuta{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/custom_feed.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
{% endblock %}

{% block content %}
<div class="card shadow-sm p-4" style="max-width: 600px; margin: 2rem auto;">
  <h2 class="mb-3">Subir Apunte</h2>
  <form id="uploadForm" action="{{ url_for('note.upload_note') }}" method="POST" enctype="multipart/form-data" novalidate>
    <input type="text" name="title" class="form-control mb-2" placeholder="TÃ­tulo del apunte" required value="{{ form_data.title if form_data else '' }}">
    <textarea name="description" class="form-control mb-2" rows="3" placeholder="DescripciÃ³n o resumen opcional">{{ form_data.description if form_data else '' }}</textarea>
    <input type="text" name="course" class="form-control mb-2" placeholder="Curso o categorÃ­a" value="{{ form_data.course if form_data else '' }}">
    <input type="file" name="note_file" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" class="form-control mb-2" required>
    <input id="upload-tags" name="tags" class="form-control mb-2" placeholder="Etiquetas" value="{{ form_data.tags if form_data else '' }}">
    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" value="1" id="termsCheck" name="terms" required title="Confirmo que tengo permiso para compartir este material. No infringe derechos de autor. Puede ser pÃºblico, educativo u original." {% if form_data and form_data.get('terms') %}checked{% endif %}>
      <label class="form-check-label" for="termsCheck">âœ… Acepto los TÃ©rminos y Condiciones</label>
    </div>
    <button type="submit" class="btn btn-primary w-100">ðŸ“¤ Publicar Apunte</button>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const uploadForm = document.getElementById('uploadForm');
  const tagInput = document.getElementById('upload-tags');
  const tagSuggestions = [
    "Ã¡lgebra",
    "Ã¡lgebra lineal",
    "derivadas",
    "integrales",
    "ecuaciones diferenciales",
    "geometrÃ­a analÃ­tica",
    "trigonometrÃ­a",
    "lÃ­mites",
    "matrices",
    "probabilidad",
    "estadÃ­stica",
    "combinatoria",
    "nÃºmeros complejos",
    "fÃ³rmulas matemÃ¡ticas",
    "lÃ³gica matemÃ¡tica",
    "fÃ­sica clÃ¡sica",
    "cinemÃ¡tica",
    "leyes de Newton",
    "ondas",
    "termodinÃ¡mica",
    "quÃ­mica orgÃ¡nica",
    "quÃ­mica inorgÃ¡nica",
    "tabla periÃ³dica",
    "reacciones quÃ­micas",
    "enlaces quÃ­micos",
    "biologÃ­a celular",
    "genÃ©tica",
    "anatomÃ­a",
    "evoluciÃ³n",
    "microbiologÃ­a",
    "historia del PerÃº",
    "historia universal",
    "revoluciÃ³n francesa",
    "independencia de AmÃ©rica",
    "filosofÃ­a moderna",
    "Ã©tica",
    "ciudadanÃ­a",
    "derechos humanos",
    "arte precolombino",
    "historia del arte",
    "psicologÃ­a",
    "sociologÃ­a",
    "antropologÃ­a",
    "redacciÃ³n",
    "ortografÃ­a",
    "tipos de texto",
    "anÃ¡lisis literario",
    "figuras literarias",
    "comprensiÃ³n lectora",
    "tÃ©cnicas de exposiciÃ³n",
    "ensayos",
    "argumentaciÃ³n",
    "citas APA",
    "referencias bibliogrÃ¡ficas",
    "programaciÃ³n",
    "pseudocÃ³digo",
    "Python",
    "HTML",
    "CSS",
    "JavaScript",
    "redes",
    "algoritmos",
    "base de datos",
    "ciberseguridad",
    "sistemas operativos",
    "informÃ¡tica educativa",
    "Excel",
    "resumen",
    "apuntes",
    "separata",
    "prÃ¡ctica resuelta",
    "soluciÃ³n paso a paso",
    "clase grabada",
    "guÃ­a de estudio",
    "tips de examen",
    "examen anterior",
    "ciclo regular",
    "sustitutorio",
    "exoneraciÃ³n",
    "educaciÃ³n inicial",
    "educaciÃ³n secundaria",
    "matemÃ¡ticas y fÃ­sica",
    "ingenierÃ­a industrial",
    "derecho",
    "medicina humana",
    "enfermerÃ­a",
    "contabilidad",
    "administraciÃ³n",
    "psicologÃ­a",
    "arquitectura",
    "agronomÃ­a",
    "UNMSM",
    "La Cantuta",
    "San Marcos",
    "UNI",
    "CEPRE",
    "EBA",
    "CEBA",
    "simulacro",
    "preuniversitario",
    "resumen grÃ¡fico",
    "infografÃ­a",
    "cuadro comparativo",
    "mapa mental",
    "ficha tÃ©cnica",
    "esquema",
    "lÃ­nea de tiempo",
    "guÃ­a de laboratorio",
    "rÃºbrica",
    "portafolio",
  ];
  let tagify;
  if (tagInput) {
    tagify = new Tagify(tagInput, { whitelist: tagSuggestions, dropdown: { maxItems: 20, enabled: 0, closeOnSelect: false } });
  }
  if (uploadForm) {
    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!uploadForm.checkValidity()) {
        uploadForm.classList.add('was-validated');
        return;
      }
      const formData = new FormData(uploadForm);
      try {
        const resp = await fetch(uploadForm.action, { method: 'POST', body: formData, headers: { 'X-Requested-With': 'XMLHttpRequest' } });
        if (!resp.ok) throw new Error('error');
        uploadForm.reset();
        if (tagify) tagify.removeAllTags();
        showToast('âœ… Apunte subido con Ã©xito');
      } catch (err) {
        alert('OcurriÃ³ un error al subir el apunte');
      }
    });
  }
});
</script>
{% endblock %}

